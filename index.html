<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Minha Cole√ß√£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#ffffff;
  --panel:#f6f7fb;
  --card:#ffffff;
  --bd:#e5e7eb;
  --txt:#0f172a;
  --mut:#64748b;
  --pri:#4f46e5;
  --pri-soft:#eef2ff;
  --ok:#15803d;
  --warn:#92400e;
  --shadow:0 10px 25px rgba(15,23,42,.08);
  --r:16px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  background:var(--bg);
  color:var(--txt);
}

.wrap{max-width:1180px;margin:auto;padding:16px}

h1{
  margin:0;
  font-size:1.5rem;
  font-weight:600;
}

.sub{
  color:var(--mut);
  font-size:.9rem;
  margin-top:4px;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:16px;
}

.btn{
  border:0;
  border-radius:999px;
  padding:8px 14px;
  cursor:pointer;
  font-weight:500;
  font-size:.9rem;
}

.btn.primary{background:var(--pri);color:#fff}
.btn.secondary{background:var(--pri-soft);color:var(--pri)}
.btn.ghost{background:#fff;border:1px solid var(--bd);color:var(--mut)}
.btn.danger{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
.btn.small{padding:6px 10px;font-size:.8rem}

.panel{
  background:var(--panel);
  border-radius:var(--r);
  padding:14px;
  margin-bottom:14px;
  box-shadow:var(--shadow);
}

/* TOPS ‚Äî MAIS LEVE */
.topsGrid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){
  .topsGrid{grid-template-columns:1fr}
}

.topBox{
  background:#fff;
  border:1px solid var(--bd);
  border-radius:14px;
  overflow:hidden;
}

.topHead{
  padding:10px 12px;
  background:#fafafa;
  border-bottom:1px solid var(--bd);
  font-weight:600;   /* üëà menos negrito */
  font-size:.95rem;
}

.topList{
  max-height:220px;
  overflow:auto;
}

.topItem{
  display:flex;
  gap:10px;
  align-items:center;
  padding:8px 12px;
  border-bottom:1px solid #f1f5f9;
  cursor:pointer;
  font-size:.85rem;
}

.topItem:hover{background:#f8fafc}

.topItem .name{
  flex:1;
  font-weight:500;  /* üëà menos negrito */
  line-height:1.2;
}

.topItem .note{
  color:var(--mut);
  font-weight:500;
}

.stars{white-space:nowrap}

/* LISTA */
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.grid{grid-template-columns:1fr}}

.card{
  background:#fff;
  border-radius:14px;
  padding:10px;
  display:flex;
  gap:10px;
  cursor:pointer;
  box-shadow:var(--shadow);
}

.poster{
  width:80px;
  height:120px;
  border-radius:12px;
  overflow:hidden;
  background:#e5e7eb;
}

.poster img{width:100%;height:100%;object-fit:cover}

.content{flex:1;min-width:0}

.title{
  font-weight:600;
  font-size:.95rem;
  line-height:1.2;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

.meta{
  color:var(--mut);
  font-size:.8rem;
  margin-top:4px;
}

.footer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:6px;
}

.status{
  font-size:.72rem;
  padding:3px 9px;
  border-radius:999px;
  font-weight:500;
}
.assistindo{background:#eef2ff;color:var(--pri)}
.assistidos{background:#dcfce7;color:var(--ok)}
.nao{background:#fef3c7;color:var(--warn)}

/* MODAL */
.backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.backdrop.show{display:flex}

.modal{
  background:#fff;
  width:min(1000px,100%);
  max-height:92vh;
  border-radius:20px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.modalHeader,
.modalFooter{
  padding:12px 14px;
  border-bottom:1px solid var(--bd);
}
.modalFooter{border-top:1px solid var(--bd);border-bottom:0}

.modalBody{
  padding:14px;
  overflow:auto;
}

/* estrelas */
.starsBox{
  font-size:1.4rem;
  cursor:pointer;
  border:1px dashed var(--bd);
  border-radius:12px;
  padding:4px 10px;
  user-select:none;
}
.starsBox.readonly{cursor:default;opacity:.9}

/* inputs */
input,select,textarea{
  width:100%;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid var(--bd);
  font-size:.9rem;
}

label{
  font-size:.75rem;
  color:var(--mut);
  font-weight:600;
}

.formGrid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px 12px;
}
.full{grid-column:1/-1}
</style>
</head>

<body>
<div class="wrap">
<header>
  <div>
    <h1>üé¨ Minha Cole√ß√£o</h1>
    <div class="sub">TOPs mais leves ¬∑ Clique para detalhes ¬∑ TMDb integrado</div>
  </div>
  <div>
    <button class="btn secondary" id="btnReload">Recarregar</button>
    <button class="btn primary" id="btnNew">+ Nova m√≠dia</button>
  </div>
</header>

<section class="panel">
  <div class="topsGrid">
    <div class="topBox">
      <div class="topHead">‚≠ê Top 10 melhores</div>
      <div class="topList" id="topBest"></div>
    </div>
    <div class="topBox">
      <div class="topHead">‚¨áÔ∏è Top 10 piores</div>
      <div class="topList" id="topWorst"></div>
    </div>
    <div class="topBox">
      <div class="topHead">üÜï √öltimos 10</div>
      <div class="topList" id="topLast"></div>
    </div>
  </div>
</section>

<section id="lista" class="grid"></section>
</div>

<div class="backdrop" id="backdrop">
  <div class="modal">
    <div class="modalHeader">
      <b id="modalTitle">Detalhes</b>
      <button class="btn ghost small" id="btnClose">Fechar</button>
    </div>
    <div class="modalBody">
      <div class="formGrid">
        <div class="full">
          <label>Nome</label>
          <input id="mNome">
        </div>

        <div>
          <label>Tipo</label>
          <select id="mTipo">
            <option value="FILME">Filme</option>
            <option value="SERIE">S√©rie</option>
          </select>
        </div>

        <div>
          <label>Status</label>
          <select id="mStatus">
            <option value="ASSISTINDO">Assistindo</option>
            <option value="ASSISTIDOS">Assistidos</option>
            <option value="AINDA_NAO_COMECEI">Ainda n√£o comecei</option>
          </select>
        </div>

        <div class="full">
          <label>Link principal</label>
          <input id="mLink">
        </div>

        <div class="full">
          <label>Avalia√ß√£o</label>
          <div class="starsBox" id="starsMidia">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
          <input id="mAvaliacao" placeholder="Ex: 3,5">
        </div>

        <div class="full">
          <label>Sinopse</label>
          <textarea id="mSinopse" rows="3"></textarea>
        </div>
      </div>
    </div>
    <div class="modalFooter">
      <button class="btn primary" id="btnSave">Salvar</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ================== CONFIG ================== */
const SUPABASE_URL="https://koytoiwfvwzjvgcqhlal.supabase.co";
const SUPABASE_KEY="SUA_ANON_KEY_AQUI";
const db=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

/* ================== HELPERS ================== */
function sanitizeRating(v){
  if(!v) return null;
  v=String(v).replace(",",".");
  let n=Number(v);
  if(!isFinite(n)) return null;
  return Math.round(Math.max(0,Math.min(5,n))*2)/2;
}
function stars(r){
  const n=sanitizeRating(r);
  if(n===null) return "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
  return "‚òÖ".repeat(Math.floor(n))+(n%1?"‚Ø®":"")+"‚òÜ".repeat(5-Math.ceil(n));
}

/* ================== STATE ================== */
let midias=[];
let current=null;

/* ================== LOAD ================== */
async function load(){
  const {data}=await db.from("midias").select("*");
  midias=data||[];
  render();
}
load();

/* ================== RENDER ================== */
function render(){
  renderTops();
  renderList();
}

function renderTops(){
  const rated=midias.filter(m=>sanitizeRating(m.avaliacao)!=null);
  const best=[...rated].sort((a,b)=>b.avaliacao-a.avaliacao).slice(0,10);
  const worst=[...rated].sort((a,b)=>a.avaliacao-b.avaliacao).slice(0,10);
  const last=[...midias].slice(-10).reverse();

  fillTop("topBest",best);
  fillTop("topWorst",worst);
  fillTop("topLast",last);
}

function fillTop(id,list){
  const el=document.getElementById(id);
  el.innerHTML="";
  list.forEach(m=>{
    const d=document.createElement("div");
    d.className="topItem";
    d.innerHTML=`<div class="name">${m.nome}</div><div class="note">${m.avaliacao??"-"}</div><div class="stars">${stars(m.avaliacao)}</div>`;
    d.onclick=()=>openModal(m);
    el.appendChild(d);
  });
}

function renderList(){
  const lista=document.getElementById("lista");
  lista.innerHTML="";
  midias.forEach(m=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <div class="poster"><img src="${m.imagem_url||''}"></div>
      <div class="content">
        <div class="title">${m.nome}</div>
        <div class="meta">${m.ano||""}</div>
        <div class="footer">
          <span class="status ${m.status==='ASSISTIDOS'?'assistidos':m.status==='ASSISTINDO'?'assistindo':'nao'}">${m.status}</span>
          <span>${stars(m.avaliacao)}</span>
        </div>
      </div>`;
    c.onclick=()=>openModal(m);
    lista.appendChild(c);
  });
}

/* ================== MODAL ================== */
const backdrop=document.getElementById("backdrop");
document.getElementById("btnClose").onclick=()=>backdrop.classList.remove("show");
document.getElementById("btnNew").onclick=()=>openModal();

function openModal(m=null){
  current=m;
  document.getElementById("modalTitle").textContent=m?"Editar":"Nova m√≠dia";
  document.getElementById("mNome").value=m?.nome||"";
  document.getElementById("mTipo").value=m?.tipo||"FILME";
  document.getElementById("mStatus").value=m?.status||"ASSISTINDO";
  document.getElementById("mLink").value=m?.link||"";
  document.getElementById("mAvaliacao").value=m?.avaliacao||"";
  document.getElementById("mSinopse").value=m?.sinopse||"";
  document.getElementById("starsMidia").textContent=stars(m?.avaliacao);
  backdrop.classList.add("show");
}

document.getElementById("btnSave").onclick=async()=>{
  const payload={
    nome:document.getElementById("mNome").value,
    tipo:document.getElementById("mTipo").value,
    status:document.getElementById("mStatus").value,
    link:document.getElementById("mLink").value,
    avaliacao:sanitizeRating(document.getElementById("mAvaliacao").value),
    sinopse:document.getElementById("mSinopse").value
  };
  if(current){
    await db.from("midias").update(payload).eq("id",current.id);
  }else{
    await db.from("midias").insert(payload);
  }
  backdrop.classList.remove("show");
  load();
};
</script>
</body>
</html>
