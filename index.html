<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minha Cole√ß√£o</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="styles.css?v=12">
</head>

<body>
  <div class="wrap">
    <header class="header">
      <div>
        <h1>üé¨ Minha Cole√ß√£o</h1>
        <div class="sub">Abas ‚Ä¢ TMDb ‚Ä¢ Franquias ‚Ä¢ TOPs ‚Ä¢ Epis√≥dios com resumo</div>
      </div>

      <div class="header-actions">
        <button class="btn ghost" id="btnReload">Recarregar</button>
        <button class="btn secondary" id="btnManage">Gerir Cole√ß√£o</button>
        <button class="btn primary" id="btnNew">+ Nova M√≠dia</button>
      </div>
    </header>

    <!-- NAV: ABAS -->
    <section class="panel">
      <div class="tabs">
        <button class="tab active" data-tab="ASSISTINDO" id="tabAssistindo">Assistindo</button>
        <button class="tab" data-tab="ASSISTIDOS">Assistidos</button>
        <button class="tab" data-tab="AINDA_NAO_COMECEI">Ainda n√£o comecei</button>
      </div>

      <div class="filters">
        <input id="fSearch" placeholder="Buscar por nome..." />
        <input id="fMinRating" placeholder="Nota m√≠nima (ex: 0,5 / 3,5)" inputmode="decimal" />

        <select id="fTipo">
          <option value="">Filmes + S√©ries</option>
          <option value="FILME">S√≥ Filmes</option>
          <option value="SERIE">S√≥ S√©ries</option>
        </select>

        <select id="fStreaming">
          <option value="">Streaming (todos)</option>
        </select>

        <select id="fAno">
          <option value="">Ano (todos)</option>
        </select>

        <select id="fGenero">
          <option value="">G√™nero (todos)</option>
        </select>

        <select id="fDiretor">
          <option value="">Diretor (todos)</option>
        </select>

        <select id="fFranquia">
          <option value="">Franquia (todas)</option>
        </select>

        <button class="btn ghost" id="btnClearFilters">Limpar filtros</button>

        <div class="count" id="countInfo"></div>
      </div>
    </section>

    <!-- DESTAQUES (somente p√°gina principal) -->
    <section class="panel" id="highlights">
      <div class="highlights-grid">
        <div class="box">
          <div class="box-head">‚≠ê Top 10 melhores</div>
          <div class="box-list" id="topBest"></div>
        </div>

        <div class="box">
          <div class="box-head">‚¨áÔ∏è Top 10 piores</div>
          <div class="box-list" id="topWorst"></div>
        </div>

        <div class="box">
          <div class="box-head">üÜï √öltimos 10 adicionados</div>
          <div class="box-list" id="topLast"></div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="franchise-wrap">
        <div class="franchise-title">üéûÔ∏è Cole√ß√µes de Franquia (clique no p√¥ster para filtrar)</div>

        <div class="franchise-two">
          <div>
            <div class="franchise-sub">Filmes</div>
            <div class="franchise-grid" id="franchisesMovies"></div>
          </div>

          <div>
            <div class="franchise-sub">S√©ries</div>
            <div class="franchise-grid" id="franchisesSeries"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- LISTA PRINCIPAL -->
    <section class="grid" id="grid"></section>

    <!-- TELA GERIR COLE√á√ÉO -->
    <section class="panel manage hidden" id="managePanel">
      <div class="manage-head">
        <div>
          <div class="manage-title">Gerir Cole√ß√£o</div>
          <div class="sub">Aqui voc√™ cadastra/edita m√≠dias e importa/exporta JSON (m√≠dias). Epis√≥dios ficam no modal da s√©rie.</div>
        </div>
        <div class="manage-actions">
          <button class="btn ghost" id="btnBack">Voltar</button>
          <button class="btn secondary" id="btnExportMidias">Exportar m√≠dias (JSON)</button>
          <button class="btn ghost" id="btnModelMidias">Baixar modelo (m√≠dias)</button>
          <label class="btn ghost filebtn">
            Importar m√≠dias
            <input type="file" id="fileImportMidias" accept="application/json" hidden>
          </label>
        </div>
      </div>

      <div class="divider"></div>

      <!-- TMDb -->
      <div class="tmdb">
        <div class="tmdb-head">
          <div>
            <div class="tmdb-title">Buscar no TMDb</div>
            <div class="sub">Digite e clique Buscar. Selecione um resultado para preencher autom√°tico.</div>
          </div>

          <select id="tmdbType">
            <option value="movie">Filme</option>
            <option value="tv">S√©rie</option>
          </select>
        </div>

        <div class="tmdb-row">
          <input id="tmdbQuery" placeholder="Ex: Matrix, Lost..." />
          <button class="btn secondary" id="btnTmdbSearch">Buscar</button>
          <button class="btn ghost" id="btnTmdbClear">Limpar</button>
        </div>

        <div class="tmdb-results hidden" id="tmdbResults"></div>
      </div>

      <div class="divider"></div>

      <div class="manage-form">
        <div class="posterBig">
          <img id="mPosterPreview" alt="poster"/>
        </div>

        <form id="formManage" class="form">
          <input type="hidden" id="mId"/>

          <div class="col2">
            <div class="field full">
              <label>Nome</label>
              <input id="mNome" required />
            </div>

            <div class="field">
              <label>Tipo</label>
              <select id="mTipo">
                <option value="FILME">Filme</option>
                <option value="SERIE">S√©rie</option>
              </select>
            </div>

            <div class="field">
              <label>Status</label>
              <select id="mStatus">
                <option value="ASSISTINDO">Assistindo</option>
                <option value="ASSISTIDOS">Assistidos</option>
                <option value="AINDA_NAO_COMECEI">Ainda n√£o comecei</option>
              </select>
            </div>

            <div class="field">
              <label>Data de lan√ßamento</label>
              <input id="mReleaseDate" type="date" />
              <div class="hint">O ano ser√° preenchido automaticamente.</div>
            </div>

            <div class="field">
              <label>Ano</label>
              <input id="mAno" type="number" min="1900" max="2100" />
            </div>

            <div class="field">
              <label>Streaming</label>
              <input id="mStreaming" placeholder="Netflix, Prime..." />
            </div>

            <div class="field">
              <label>G√™nero</label>
              <input id="mGenero" placeholder="A√ß√£o, Drama..." />
            </div>

            <div class="field">
              <label>Diretor(es)</label>
              <input id="mDiretor" placeholder="Nome(s) do diretor" />
            </div>

            <div class="field">
              <label>Franquia</label>
              <input id="mFranquia" placeholder="Ex: Matrix" />
            </div>

            <div class="field full">
              <label>URL do p√¥ster</label>
              <input id="mImagemUrl" placeholder="https://...jpg" />
            </div>

            <div class="field full">
              <label>Link principal</label>
              <input id="mLink" placeholder="https://..." />
            </div>

            <div class="field full">
              <label>Links (1 por linha)</label>
              <textarea id="mLinks" rows="3" placeholder="https://...\nhttps://..."></textarea>
            </div>

            <div class="field full">
              <label>Avalia√ß√£o (0 a 5, meia estrela)</label>
              <div class="ratingRow">
                <div class="starsBox" id="starsMidia" title="Clique para definir (meia estrela)">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
                <input id="mAvaliacao" placeholder="Ex: 0,5 / 3,5" inputmode="decimal" />
              </div>
            </div>

            <div class="field full">
              <label>Sinopse</label>
              <textarea id="mSinopse" rows="4"></textarea>
            </div>

            <details class="advanced">
              <summary>Campos avan√ßados (TMDb/JSON)</summary>
              <div class="advGrid">
                <div class="field">
                  <label>tmdb_id</label>
                  <input id="mTmdbId" class="mono" />
                </div>
                <div class="field">
                  <label>imdb_id</label>
                  <input id="mImdbId" class="mono" />
                </div>

                <div class="field full">
                  <label>cast_data (JSON)</label>
                  <textarea id="mCastData" rows="4" class="mono"></textarea>
                </div>

                <div class="field full">
                  <label>networks (JSON)</label>
                  <textarea id="mNetworks" rows="3" class="mono"></textarea>
                </div>

                <div class="field full">
                  <label>keywords (JSON)</label>
                  <textarea id="mKeywords" rows="3" class="mono"></textarea>
                </div>
              </div>
            </details>

            <div class="formActions">
              <button class="btn primary" type="submit" id="btnSaveManage">Salvar</button>
              <button class="btn danger" type="button" id="btnDeleteManage">Excluir</button>
              <button class="btn ghost" type="button" id="btnResetManage">Limpar formul√°rio</button>
            </div>
          </div>
        </form>
      </div>

      <div class="divider"></div>

      <div class="manage-list">
        <div class="manage-title">Itens cadastrados</div>
        <div class="grid" id="manageGrid"></div>
      </div>
    </section>
  </div>

  <!-- MODAL DETALHES -->
  <div class="backdrop hidden" id="modalBackdrop">
    <div class="modal">
      <div class="modalHead">
        <div class="modalTitles">
          <div class="modalTitle" id="dTitle">Detalhes</div>
          <div class="modalSub" id="dSub"></div>
        </div>
        <div class="modalHeadActions">
          <button class="btn ghost" id="btnCloseModal">Fechar</button>
        </div>
      </div>

      <div class="modalBody" id="modalBody">
        <div class="modalMain">
          <div class="modalPoster">
            <img id="dPoster" alt="poster">
          </div>

          <div class="modalInfo">
            <div class="badges">
              <span class="pill" id="dTipo"></span>
              <span class="pill" id="dStatus"></span>
              <span class="pill" id="dAno"></span>
              <span class="pill" id="dStreaming"></span>
              <span class="pill" id="dGenero"></span>
              <span class="pill" id="dDiretor"></span>
              <span class="pill" id="dFranquia"></span>
            </div>

            <div class="modalStars">
              <span class="note" id="dNote"></span>
              <span class="starsSmall" id="dStars"></span>
            </div>

            <div class="section">
              <div class="sectionTitle">Sinopse</div>
              <div class="text" id="dSinopse"></div>
            </div>

            <div class="section">
              <div class="sectionTitle">Links</div>
              <div class="links" id="dLinks"></div>
            </div>
          </div>
        </div>

        <!-- EPIS√ìDIOS (somente s√©ries) -->
        <div class="eps hidden" id="epsBox">
          <div class="divider"></div>

          <div class="epsHead">
            <div>
              <div class="sectionTitle">Guia de Epis√≥dios</div>
              <div class="sub">Agrupado por temporada e por status.</div>
            </div>

            <div class="epsActions">
              <button class="btn secondary" id="btnAddEp">+ Epis√≥dio</button>

              <button class="btn ghost" id="btnExportEps">Exportar epis√≥dios</button>
              <button class="btn ghost" id="btnModelEps">Modelo importa√ß√£o</button>

              <label class="btn ghost filebtn">
                Importar epis√≥dios
                <input type="file" id="fileImportEps" accept="application/json" hidden>
              </label>
            </div>
          </div>

          <div class="epsForm hidden" id="epForm">
            <div class="epsFormTop">
              <b id="epFormTitle">Novo epis√≥dio</b>
              <button class="btn ghost" id="btnCancelEp">Fechar</button>
            </div>

            <div class="divider"></div>

            <form id="formEp" class="form">
              <input type="hidden" id="epId">

              <div class="epGrid">
                <div class="field">
                  <label>Temporada</label>
                  <input id="epSeason" type="number" min="1" required>
                </div>

                <div class="field">
                  <label>N¬∫ epis√≥dio</label>
                  <input id="epNumber" type="number" min="1" required>
                </div>

                <div class="field full">
                  <label>T√≠tulo</label>
                  <input id="epTitle" placeholder="Opcional">
                </div>

                <div class="field full">
                  <label>Resumo</label>
                  <textarea id="epResumo" rows="3"></textarea>
                </div>

                <div class="field">
                  <label>Status</label>
                  <select id="epStatus">
                    <option value="AINDA_NAO_COMECEI">Ainda n√£o comecei</option>
                    <option value="ASSISTINDO">Assistindo</option>
                    <option value="ASSISTIDOS">Assistidos</option>
                  </select>
                </div>

                <div class="field full">
                  <label>Avalia√ß√£o (0 a 5, meia estrela)</label>
                  <div class="ratingRow">
                    <div class="starsBox" id="starsEp">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
                    <input id="epRating" placeholder="Ex: 0,5 / 4,5" inputmode="decimal">
                  </div>
                </div>

                <div class="formActions">
                  <button class="btn primary" type="submit">Salvar epis√≥dio</button>
                </div>
              </div>
            </form>
          </div>

          <div id="epsGrouped"></div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="btn danger" id="btnDelete">Excluir</button>
        <div class="right">
          <button class="btn ghost" id="btnEdit">Editar</button>
          <button class="btn primary hidden" id="btnSave">Salvar altera√ß√µes</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast hidden" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.6/dist/umd/supabase.min.js"></script>
  <script src="app.js?v=12"></script>
</body>
</html>
